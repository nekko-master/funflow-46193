<section class="plan-steps-subsection">
  <h3 class="subsection-title"><%= title %></h3>
  <p class="subsection-description"><%= description %></p>

  <ol class="plan-steps">
    <% steps.each_with_index do |step, index| %>
      <li class="plan-step">
        <div class="step-main">
          <span class="step-number"><%= index + 1 %></span>

          <div class="step-content">
            <p class="step-title">
              <%= step.action_type.name %> ／ <%= step.target.name %>
            </p>

            <% if step.time.present? || step.note.present? %>
              <p class="step-meta">
                <% if step.time.present? %>
                  <span class="step-time">
                    <%= step.time.is_a?(String) ? step.time : step.time.strftime("%H:%M") %>
                  </span>
                <% end %>

                <% if step.note.present? %>
                  <span class="step-note">
                    <%= simple_format(step.note) %>
                  </span>
                <% end %>
              </p>
            <% end %>

            <%# 保存済みプランなら編集ボタンを表示 %>
            <% if local_assigns[:show_edit_button] %>
              <div class="step-actions">
                <%= link_to "編集",
                            edit_plan_plan_step_path(@plan, step),
                            class: "secondary-button" %>
                <%= link_to "削除",
                  plan_plan_step_path(@plan, step),
                  method: :delete,
                  data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？" },
                  class: "tertiary-button is-danger" %>
              </div>
            <% end %>

          </div>
        </div>
      </li>
    <% end %>
  </ol>
</section>
